<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Exception handling and stack unwinding for x64."><meta name="keywords" content="rust, rustlang, rust-lang, exception"><title>goblin::pe::exception - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Regular-1f7d512b176f0f72.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Bold-124a1ca42af929b6.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-93196c7a1c3542a8.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../../../static.files/light-4743e13df3dfe8c4.css"><link rel="stylesheet" disabled href="../../../static.files/dark-0e1b889528bd466b.css"><link rel="stylesheet" disabled href="../../../static.files/ayu-65289d5d067c7c66.css"><script id="default-settings" ></script><script src="../../../static.files/storage-d43fa987303ecbbb.js"></script><script defer src="../../../static.files/main-3367e395607fafc1.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../../goblin/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../../goblin/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Module exception</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../../index.html">goblin</a>::<wbr><a href="../index.html">pe</a>::<wbr><a class="mod" href="#">exception</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../../src/goblin/pe/exception.rs.html#1-1058">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Exception handling and stack unwinding for x64.</p>
<p>Exception information is exposed via the <a href="struct.ExceptionData.html"><code>ExceptionData</code></a> structure. If present in a PE file,
it contains a list of <a href="struct.RuntimeFunction.html"><code>RuntimeFunction</code></a> entries that can be used to get <a href="struct.UnwindInfo.html"><code>UnwindInfo</code></a> for a
particular code location.</p>
<p>Unwind information contains a list of unwind codes which specify the operations that are
necessary to restore registers (including the stack pointer RSP) when unwinding out of a
function.</p>
<p>Depending on where the instruction pointer lies, there are three strategies to unwind:</p>
<ol>
<li>
<p>If the RIP is within an epilog, then control is leaving the function, there can be no
exception handler associated with this exception for this function, and the effects of the
epilog must be continued to compute the context of the caller function. To determine if the
RIP is within an epilog, the code stream from RIP on is examined. If that code stream can be
matched to the trailing portion of a legitimate epilog, then it’s in an epilog, and the
remaining portion of the epilog is simulated, with the context record updated as each
instruction is processed. After this, step 1 is repeated.</p>
</li>
<li>
<p>Case b) If the RIP lies within the prologue, then control has not entered the function,
there can be no exception handler associated with this exception for this function, and the
effects of the prolog must be undone to compute the context of the caller function. The RIP
is within the prolog if the distance from the function start to the RIP is less than or
equal to the prolog size encoded in the unwind info. The effects of the prolog are unwound
by scanning forward through the unwind codes array for the first entry with an offset less
than or equal to the offset of the RIP from the function start, then undoing the effect of
all remaining items in the unwind code array. Step 1 is then repeated.</p>
</li>
<li>
<p>If the RIP is not within a prolog or epilog and the function has an exception handler, then
the language-specific handler is called. The handler scans its data and calls filter
functions as appropriate. The language-specific handler can return that the exception was
handled or that the search is to be continued. It can also initiate an unwind directly.</p>
</li>
</ol>
<p>For more information, see <a href="https://docs.microsoft.com/en-us/cpp/build/exception-handling-x64?view=vs-2017">x64 exception handling</a>.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ExceptionData.html" title="goblin::pe::exception::ExceptionData struct">ExceptionData</a></div><div class="item-right docblock-short">Exception handling and stack unwind information for functions in the image.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Register.html" title="goblin::pe::exception::Register struct">Register</a></div><div class="item-right docblock-short">An x64 register used during unwinding.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.RuntimeFunction.html" title="goblin::pe::exception::RuntimeFunction struct">RuntimeFunction</a></div><div class="item-right docblock-short">An unwind entry for a range of a function.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.RuntimeFunctionIterator.html" title="goblin::pe::exception::RuntimeFunctionIterator struct">RuntimeFunctionIterator</a></div><div class="item-right docblock-short">Iterator over runtime function entries in <a href="struct.ExceptionData.html"><code>ExceptionData</code></a>.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.UnwindCode.html" title="goblin::pe::exception::UnwindCode struct">UnwindCode</a></div><div class="item-right docblock-short">An unwind operation that is executed at a particular place in the function prolog.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.UnwindCodeIterator.html" title="goblin::pe::exception::UnwindCodeIterator struct">UnwindCodeIterator</a></div><div class="item-right docblock-short">An iterator over unwind codes for a function or part of a function, returned from
<a href="struct.UnwindInfo.html"><code>UnwindInfo</code></a>.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.UnwindInfo.html" title="goblin::pe::exception::UnwindInfo struct">UnwindInfo</a></div><div class="item-right docblock-short">Unwind information for a function or portion of a function.</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.StackFrameOffset.html" title="goblin::pe::exception::StackFrameOffset enum">StackFrameOffset</a></div><div class="item-right docblock-short">An unsigned offset to a value in the local stack frame.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.UnwindHandler.html" title="goblin::pe::exception::UnwindHandler enum">UnwindHandler</a></div><div class="item-right docblock-short">A language-specific handler that is called as part of the search for an exception handler or as
part of an unwind.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.UnwindOperation.html" title="goblin::pe::exception::UnwindOperation enum">UnwindOperation</a></div><div class="item-right docblock-short">An unwind operation corresponding to code in the function prolog.</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="goblin" data-themes="" data-resource-suffix="" data-rustdoc-version="1.68.1 (8460ca823 2023-03-20)" data-search-js="search-98d53477a794af0b.js" data-settings-js="settings-c3c521c753752a1a.js" data-settings-css="settings-08ddfdda51b8ee2e.css" ></div></body></html>